"use strict";var WebMMuxer=(()=>{var Bt=Object.defineProperty;var hi=Object.getOwnPropertyDescriptor;var di=Object.getOwnPropertyNames,De=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,li=Object.prototype.propertyIsEnumerable;var b=Math.pow,Ve=(h,t,i)=>t in h?Bt(h,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[t]=i,ve=(h,t)=>{for(var i in t||={})Pe.call(t,i)&&Ve(h,i,t[i]);if(De)for(var i of De(t))li.call(t,i)&&Ve(h,i,t[i]);return h};var ui=(h,t)=>{for(var i in t)Bt(h,i,{get:t[i],enumerable:!0})},fi=(h,t,i,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of di(t))!Pe.call(h,r)&&r!==i&&Bt(h,r,{get:()=>t[r],enumerable:!(s=hi(t,r))||s.enumerable});return h};var ci=h=>fi(Bt({},"__esModule",{value:!0}),h);var ge=(h,t,i)=>{if(!t.has(h))throw TypeError("Cannot "+i)};var e=(h,t,i)=>(ge(h,t,"read from private field"),i?i.call(h):t.get(h)),n=(h,t,i)=>{if(t.has(h))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(h):t.set(h,i)},f=(h,t,i,s)=>(ge(h,t,"write to private field"),s?s.call(h,i):t.set(h,i),i);var o=(h,t,i)=>(ge(h,t,"access private method"),i);var ki={};ui(ki,{ArrayBufferTarget:()=>ct,FileSystemWritableFileStreamTarget:()=>mt,Muxer:()=>te,StreamTarget:()=>_,SubtitleEncoder:()=>me});var q=class{constructor(t){this.value=t}},M=class{constructor(t){this.value=t}};var we=h=>h<1<<8?1:h<1<<16?2:h<1<<24?3:h<b(2,32)?4:h<b(2,40)?5:6,Re=h=>{if(h<(1<<7)-1)return 1;if(h<(1<<14)-1)return 2;if(h<(1<<21)-1)return 3;if(h<(1<<28)-1)return 4;if(h<b(2,35)-1)return 5;if(h<b(2,42)-1)return 6;throw new Error("EBML VINT size not supported "+h)};var F=(h,t,i)=>{let s=0;for(let r=t;r<i;r++){let a=Math.floor(r/8),l=h[a],m=7-(r&7),w=(l&1<<m)>>m;s<<=1,s|=w}return s},Me=(h,t,i,s)=>{for(let r=t;r<i;r++){let a=Math.floor(r/8),l=h[a],m=7-(r&7);l&=~(1<<m),l|=(s&1<<i-r-1)>>i-r-1<<m,h[a]=l}};var ct=class{constructor(){this.buffer=null}},_=class{constructor(t,i,s){this.onData=t;this.onDone=i;this.options=s}},mt=class{constructor(t,i){this.stream=t;this.options=i}};var x,c,Kt,Fe,Gt,_e,Yt,Ne,wt,ye,Zt,Oe,bt=class{constructor(){n(this,Kt);n(this,Gt);n(this,Yt);n(this,wt);n(this,Zt);this.pos=0;n(this,x,new Uint8Array(8));n(this,c,new DataView(e(this,x).buffer));this.offsets=new WeakMap;this.dataOffsets=new WeakMap}seek(t){this.pos=t}writeEBMLVarInt(t,i=Re(t)){let s=0;switch(i){case 1:e(this,c).setUint8(s++,1<<7|t);break;case 2:e(this,c).setUint8(s++,1<<6|t>>8),e(this,c).setUint8(s++,t);break;case 3:e(this,c).setUint8(s++,1<<5|t>>16),e(this,c).setUint8(s++,t>>8),e(this,c).setUint8(s++,t);break;case 4:e(this,c).setUint8(s++,1<<4|t>>24),e(this,c).setUint8(s++,t>>16),e(this,c).setUint8(s++,t>>8),e(this,c).setUint8(s++,t);break;case 5:e(this,c).setUint8(s++,1<<3|t/b(2,32)&7),e(this,c).setUint8(s++,t>>24),e(this,c).setUint8(s++,t>>16),e(this,c).setUint8(s++,t>>8),e(this,c).setUint8(s++,t);break;case 6:e(this,c).setUint8(s++,1<<2|t/b(2,40)&3),e(this,c).setUint8(s++,t/b(2,32)|0),e(this,c).setUint8(s++,t>>24),e(this,c).setUint8(s++,t>>16),e(this,c).setUint8(s++,t>>8),e(this,c).setUint8(s++,t);break;default:throw new Error("Bad EBML VINT size "+i)}this.write(e(this,x).subarray(0,s))}writeEBML(t){var i,s;if(t!==null)if(t instanceof Uint8Array)this.write(t);else if(Array.isArray(t))for(let r of t)this.writeEBML(r);else if(this.offsets.set(t,this.pos),o(this,wt,ye).call(this,t.id),Array.isArray(t.data)){let r=this.pos,a=t.size===-1?1:(i=t.size)!=null?i:4;t.size===-1?o(this,Kt,Fe).call(this,255):this.seek(this.pos+a);let l=this.pos;if(this.dataOffsets.set(t,l),this.writeEBML(t.data),t.size!==-1){let m=this.pos-l,w=this.pos;this.seek(r),this.writeEBMLVarInt(m,a),this.seek(w)}}else if(typeof t.data=="number"){let r=(s=t.size)!=null?s:we(t.data);this.writeEBMLVarInt(r),o(this,wt,ye).call(this,t.data,r)}else typeof t.data=="string"?(this.writeEBMLVarInt(t.data.length),o(this,Zt,Oe).call(this,t.data)):t.data instanceof Uint8Array?(this.writeEBMLVarInt(t.data.byteLength,t.size),this.write(t.data)):t.data instanceof q?(this.writeEBMLVarInt(4),o(this,Gt,_e).call(this,t.data.value)):t.data instanceof M&&(this.writeEBMLVarInt(8),o(this,Yt,Ne).call(this,t.data.value))}};x=new WeakMap,c=new WeakMap,Kt=new WeakSet,Fe=function(t){e(this,c).setUint8(0,t),this.write(e(this,x).subarray(0,1))},Gt=new WeakSet,_e=function(t){e(this,c).setFloat32(0,t,!1),this.write(e(this,x).subarray(0,4))},Yt=new WeakSet,Ne=function(t){e(this,c).setFloat64(0,t,!1),this.write(e(this,x))},wt=new WeakSet,ye=function(t,i=we(t)){let s=0;switch(i){case 6:e(this,c).setUint8(s++,t/b(2,40)|0);case 5:e(this,c).setUint8(s++,t/b(2,32)|0);case 4:e(this,c).setUint8(s++,t>>24);case 3:e(this,c).setUint8(s++,t>>16);case 2:e(this,c).setUint8(s++,t>>8);case 1:e(this,c).setUint8(s++,t);break;default:throw new Error("Bad UINT size "+i)}this.write(e(this,x).subarray(0,s))},Zt=new WeakSet,Oe=function(t){this.write(new Uint8Array(t.split("").map(i=>i.charCodeAt(0))))};var yt,z,Q,Ct,Ce,Wt=class extends bt{constructor(i){super();n(this,Ct);n(this,yt,void 0);n(this,z,new ArrayBuffer(b(2,16)));n(this,Q,new Uint8Array(e(this,z)));f(this,yt,i)}write(i){o(this,Ct,Ce).call(this,this.pos+i.byteLength),e(this,Q).set(i,this.pos),this.pos+=i.byteLength}finalize(){o(this,Ct,Ce).call(this,this.pos),e(this,yt).buffer=e(this,z).slice(0,this.pos)}};yt=new WeakMap,z=new WeakMap,Q=new WeakMap,Ct=new WeakSet,Ce=function(i){let s=e(this,z).byteLength;for(;s<i;)s*=2;if(s===e(this,z).byteLength)return;let r=new ArrayBuffer(s),a=new Uint8Array(r);a.set(e(this,Q),0),f(this,z,r),f(this,Q,a)};var X,D,Tt,kt,pt=class extends bt{constructor(i,s){super();n(this,X,void 0);n(this,D,[]);n(this,Tt,0);n(this,kt,void 0);f(this,X,i),f(this,kt,s)}write(i){e(this,D).push({data:i.slice(),start:this.pos}),this.pos+=i.byteLength}flush(){if(e(this,D).length===0)return;let i=[],s=[...e(this,D)].sort((r,a)=>r.start-a.start);i.push({start:s[0].start,size:s[0].data.byteLength});for(let r=1;r<s.length;r++){let a=i[i.length-1],l=s[r];l.start<=a.start+a.size?a.size=Math.max(a.size,l.start+l.data.byteLength-a.start):i.push({start:l.start,size:l.data.byteLength})}for(let r of i){r.data=new Uint8Array(r.size);for(let a of e(this,D))r.start<=a.start&&a.start<r.start+r.size&&r.data.set(a.data,a.start-r.start);if(e(this,kt)&&r.start<e(this,Tt))throw new Error("Internal error: Monotonicity violation.");e(this,X).onData(r.data,r.start),f(this,Tt,r.start+r.data.byteLength)}e(this,D).length=0}finalize(){var i,s;(s=(i=e(this,X)).onDone)==null||s.call(i)}};X=new WeakMap,D=new WeakMap,Tt=new WeakMap,kt=new WeakMap;var mi=b(2,24),bi=2,j,y,g,xt,St,At,Te,qt,Be,Qt,He,J,Ht,gt=class extends bt{constructor(i,s){var r,a;super();n(this,At);n(this,qt);n(this,Qt);n(this,J);n(this,j,void 0);n(this,y,void 0);n(this,g,[]);n(this,xt,0);n(this,St,void 0);if(f(this,j,i),f(this,y,(a=(r=i.options)==null?void 0:r.chunkSize)!=null?a:mi),f(this,St,s),!Number.isInteger(e(this,y))||e(this,y)<b(2,10))throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(i){o(this,At,Te).call(this,i,this.pos),o(this,J,Ht).call(this),this.pos+=i.byteLength}finalize(){var i,s;o(this,J,Ht).call(this,!0),(s=(i=e(this,j)).onDone)==null||s.call(i)}};j=new WeakMap,y=new WeakMap,g=new WeakMap,xt=new WeakMap,St=new WeakMap,At=new WeakSet,Te=function(i,s){let r=e(this,g).findIndex(p=>p.start<=s&&s<p.start+e(this,y));r===-1&&(r=o(this,Qt,He).call(this,s));let a=e(this,g)[r],l=s-a.start,m=i.subarray(0,Math.min(e(this,y)-l,i.byteLength));a.data.set(m,l);let w={start:l,end:l+m.byteLength};if(o(this,qt,Be).call(this,a,w),a.written[0].start===0&&a.written[0].end===e(this,y)&&(a.shouldFlush=!0),e(this,g).length>bi){for(let p=0;p<e(this,g).length-1;p++)e(this,g)[p].shouldFlush=!0;o(this,J,Ht).call(this)}m.byteLength<i.byteLength&&o(this,At,Te).call(this,i.subarray(m.byteLength),s+m.byteLength)},qt=new WeakSet,Be=function(i,s){let r=0,a=i.written.length-1,l=-1;for(;r<=a;){let m=Math.floor(r+(a-r+1)/2);i.written[m].start<=s.start?(r=m+1,l=m):a=m-1}for(i.written.splice(l+1,0,s),(l===-1||i.written[l].end<s.start)&&l++;l<i.written.length-1&&i.written[l].end>=i.written[l+1].start;)i.written[l].end=Math.max(i.written[l].end,i.written[l+1].end),i.written.splice(l+1,1)},Qt=new WeakSet,He=function(i){let r={start:Math.floor(i/e(this,y))*e(this,y),data:new Uint8Array(e(this,y)),written:[],shouldFlush:!1};return e(this,g).push(r),e(this,g).sort((a,l)=>a.start-l.start),e(this,g).indexOf(r)},J=new WeakSet,Ht=function(i=!1){for(let s=0;s<e(this,g).length;s++){let r=e(this,g)[s];if(!(!r.shouldFlush&&!i)){for(let a of r.written){if(e(this,St)&&r.start+a.start<e(this,xt))throw new Error("Internal error: Monotonicity violation.");e(this,j).onData(r.data.subarray(a.start,a.end),r.start+a.start),f(this,xt,r.start+a.end)}e(this,g).splice(s--,1)}}};var $t=class extends gt{constructor(t,i){var s;super(new _((r,a)=>t.stream.write({type:"write",data:r,position:a}),void 0,{chunkSize:(s=t.options)==null?void 0:s.chunkSize}),i)}};var L=1,Ut=2,Xt=3,pi=1,gi=2,wi=17,ke=b(2,15),Et=b(2,12),We="https://github.com/Vanilagy/webm-muxer",$e=6,Ke=5,yi=["strict","offset","permissive"],d,u,et,it,T,N,O,V,B,A,H,W,k,st,$,U,E,P,rt,at,K,G,Dt,nt,Vt,ee,Ge,ie,Ye,se,Ze,re,qe,ae,Qe,ne,Xe,oe,je,Pt,xe,vt,Se,he,Je,v,I,R,tt,de,Le,le,Ie,ot,jt,ht,Jt,ue,ti,C,S,Y,zt,dt,Lt,fe,ei,Rt,Ae,lt,It,te=class{constructor(t){n(this,ee);n(this,ie);n(this,se);n(this,re);n(this,ae);n(this,ne);n(this,oe);n(this,Pt);n(this,vt);n(this,he);n(this,v);n(this,R);n(this,de);n(this,le);n(this,ot);n(this,ht);n(this,ue);n(this,C);n(this,Y);n(this,dt);n(this,fe);n(this,Rt);n(this,lt);n(this,d,void 0);n(this,u,void 0);n(this,et,void 0);n(this,it,void 0);n(this,T,void 0);n(this,N,void 0);n(this,O,void 0);n(this,V,void 0);n(this,B,void 0);n(this,A,void 0);n(this,H,void 0);n(this,W,void 0);n(this,k,void 0);n(this,st,void 0);n(this,$,0);n(this,U,[]);n(this,E,[]);n(this,P,[]);n(this,rt,void 0);n(this,at,void 0);n(this,K,-1);n(this,G,-1);n(this,Dt,-1);n(this,nt,void 0);n(this,Vt,!1);var s;o(this,ee,Ge).call(this,t),f(this,d,ve({type:"webm",firstTimestampBehavior:"strict"},t)),this.target=t.target;let i=!!e(this,d).streaming;if(t.target instanceof ct)f(this,u,new Wt(t.target));else if(t.target instanceof _)f(this,u,(s=t.target.options)!=null&&s.chunked?new gt(t.target,i):new pt(t.target,i));else if(t.target instanceof mt)f(this,u,new $t(t.target,i));else throw new Error(`Invalid target: ${t.target}`);o(this,ie,Ye).call(this)}addVideoChunk(t,i,s){let r=new Uint8Array(t.byteLength);t.copyTo(r),this.addVideoChunkRaw(r,t.type,s!=null?s:t.timestamp,i)}addVideoChunkRaw(t,i,s,r){if(o(this,lt,It).call(this),!e(this,d).video)throw new Error("No video track declared.");e(this,rt)===void 0&&f(this,rt,s),r&&o(this,de,Le).call(this,r);let a=o(this,ht,Jt).call(this,t,i,s,L);for(e(this,d).video.codec==="V_VP9"&&o(this,le,Ie).call(this,a),f(this,K,a.timestamp);e(this,E).length>0&&e(this,E)[0].timestamp<=a.timestamp;){let l=e(this,E).shift();o(this,C,S).call(this,l,!1)}!e(this,d).audio||a.timestamp<=e(this,G)?o(this,C,S).call(this,a,!0):e(this,U).push(a),o(this,ot,jt).call(this),o(this,v,I).call(this)}addAudioChunk(t,i,s){let r=new Uint8Array(t.byteLength);t.copyTo(r),this.addAudioChunkRaw(r,t.type,s!=null?s:t.timestamp,i)}addAudioChunkRaw(t,i,s,r){if(o(this,lt,It).call(this),!e(this,d).audio)throw new Error("No audio track declared.");e(this,at)===void 0&&f(this,at,s),r!=null&&r.decoderConfig&&(e(this,d).streaming?f(this,A,o(this,Y,zt).call(this,r.decoderConfig.description)):o(this,dt,Lt).call(this,e(this,A),r.decoderConfig.description));let a=o(this,ht,Jt).call(this,t,i,s,Ut);for(f(this,G,a.timestamp);e(this,U).length>0&&e(this,U)[0].timestamp<=a.timestamp;){let l=e(this,U).shift();o(this,C,S).call(this,l,!0)}!e(this,d).video||a.timestamp<=e(this,K)?o(this,C,S).call(this,a,!e(this,d).video):e(this,E).push(a),o(this,ot,jt).call(this),o(this,v,I).call(this)}addSubtitleChunk(t,i){if(o(this,lt,It).call(this),!e(this,d).subtitles)throw new Error("No subtitle track declared.");i!=null&&i.decoderConfig&&(e(this,d).streaming?f(this,H,o(this,Y,zt).call(this,i.decoderConfig.description)):o(this,dt,Lt).call(this,e(this,H),i.decoderConfig.description));let s=o(this,ht,Jt).call(this,t.body,"key",t.timestamp,Xt,t.duration,t.additions);f(this,Dt,s.timestamp),e(this,P).push(s),o(this,ot,jt).call(this),o(this,v,I).call(this)}finalize(){for(;e(this,U).length>0;)o(this,C,S).call(this,e(this,U).shift(),!0);for(;e(this,E).length>0;)o(this,C,S).call(this,e(this,E).shift(),!0);for(;e(this,P).length>0&&e(this,P)[0].timestamp<=e(this,$);)o(this,C,S).call(this,e(this,P).shift(),!1);if(e(this,d).streaming||o(this,Rt,Ae).call(this),e(this,u).writeEBML(e(this,W)),!e(this,d).streaming){let t=e(this,u).pos,i=e(this,u).pos-e(this,R,tt);e(this,u).seek(e(this,u).offsets.get(e(this,et))+4),e(this,u).writeEBMLVarInt(i,$e),e(this,O).data=new M(e(this,$)),e(this,u).seek(e(this,u).offsets.get(e(this,O))),e(this,u).writeEBML(e(this,O)),e(this,T).data[0].data[1].data=e(this,u).offsets.get(e(this,W))-e(this,R,tt),e(this,T).data[1].data[1].data=e(this,u).offsets.get(e(this,it))-e(this,R,tt),e(this,T).data[2].data[1].data=e(this,u).offsets.get(e(this,N))-e(this,R,tt),e(this,u).seek(e(this,u).offsets.get(e(this,T))),e(this,u).writeEBML(e(this,T)),e(this,u).seek(t)}o(this,v,I).call(this),e(this,u).finalize(),f(this,Vt,!0)}};d=new WeakMap,u=new WeakMap,et=new WeakMap,it=new WeakMap,T=new WeakMap,N=new WeakMap,O=new WeakMap,V=new WeakMap,B=new WeakMap,A=new WeakMap,H=new WeakMap,W=new WeakMap,k=new WeakMap,st=new WeakMap,$=new WeakMap,U=new WeakMap,E=new WeakMap,P=new WeakMap,rt=new WeakMap,at=new WeakMap,K=new WeakMap,G=new WeakMap,Dt=new WeakMap,nt=new WeakMap,Vt=new WeakMap,ee=new WeakSet,Ge=function(t){if(t.type&&t.type!=="webm"&&t.type!=="matroska")throw new Error(`Invalid type: ${t.type}`);if(t.firstTimestampBehavior&&!yi.includes(t.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${t.firstTimestampBehavior}`)},ie=new WeakSet,Ye=function(){o(this,se,Ze).call(this),e(this,d).streaming||o(this,ne,Xe).call(this),o(this,oe,je).call(this),o(this,re,qe).call(this),o(this,ae,Qe).call(this),e(this,d).streaming||(o(this,Pt,xe).call(this),o(this,vt,Se).call(this)),o(this,he,Je).call(this),o(this,v,I).call(this)},se=new WeakSet,Ze=function(){var i;let t={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:(i=e(this,d).type)!=null?i:"webm"},{id:17031,data:2},{id:17029,data:2}]};e(this,u).writeEBML(t)},re=new WeakSet,qe=function(){f(this,B,{id:236,size:4,data:new Uint8Array(Et)}),f(this,A,{id:236,size:4,data:new Uint8Array(Et)}),f(this,H,{id:236,size:4,data:new Uint8Array(Et)})},ae=new WeakSet,Qe=function(){f(this,V,{id:21936,data:[{id:21937,data:2},{id:21946,data:2},{id:21947,data:2},{id:21945,data:0}]})},ne=new WeakSet,Xe=function(){let t=new Uint8Array([28,83,187,107]),i=new Uint8Array([21,73,169,102]),s=new Uint8Array([22,84,174,107]),r={id:290298740,data:[{id:19899,data:[{id:21419,data:t},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:i},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:s},{id:21420,size:5,data:0}]}]};f(this,T,r)},oe=new WeakSet,je=function(){let t={id:17545,data:new M(0)};f(this,O,t);let i={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:We},{id:22337,data:We},e(this,d).streaming?null:t]};f(this,it,i)},Pt=new WeakSet,xe=function(){let t={id:374648427,data:[]};f(this,N,t),e(this,d).video&&t.data.push({id:174,data:[{id:215,data:L},{id:29637,data:L},{id:131,data:pi},{id:134,data:e(this,d).video.codec},e(this,B),e(this,d).video.frameRate?{id:2352003,data:1e9/e(this,d).video.frameRate}:null,{id:224,data:[{id:176,data:e(this,d).video.width},{id:186,data:e(this,d).video.height},e(this,d).video.alpha?{id:21440,data:1}:null,e(this,V)]}]}),e(this,d).audio&&(f(this,A,e(this,d).streaming?e(this,A)||null:{id:236,size:4,data:new Uint8Array(Et)}),t.data.push({id:174,data:[{id:215,data:Ut},{id:29637,data:Ut},{id:131,data:gi},{id:134,data:e(this,d).audio.codec},e(this,A),{id:225,data:[{id:181,data:new q(e(this,d).audio.sampleRate)},{id:159,data:e(this,d).audio.numberOfChannels},e(this,d).audio.bitDepth?{id:25188,data:e(this,d).audio.bitDepth}:null]}]})),e(this,d).subtitles&&t.data.push({id:174,data:[{id:215,data:Xt},{id:29637,data:Xt},{id:131,data:wi},{id:134,data:e(this,d).subtitles.codec},e(this,H)]})},vt=new WeakSet,Se=function(){let t={id:408125543,size:e(this,d).streaming?-1:$e,data:[e(this,d).streaming?null:e(this,T),e(this,it),e(this,N)]};f(this,et,t),e(this,u).writeEBML(t)},he=new WeakSet,Je=function(){f(this,W,{id:475249515,data:[]})},v=new WeakSet,I=function(){e(this,u)instanceof pt&&e(this,u).flush()},R=new WeakSet,tt=function(){return e(this,u).dataOffsets.get(e(this,et))},de=new WeakSet,Le=function(t){if(!!t.decoderConfig){if(t.decoderConfig.colorSpace){let i=t.decoderConfig.colorSpace;if(f(this,nt,i),e(this,V).data=[{id:21937,data:{rgb:1,bt709:1,bt470bg:5,smpte170m:6}[i.matrix]},{id:21946,data:{bt709:1,smpte170m:6,"iec61966-2-1":13}[i.transfer]},{id:21947,data:{bt709:1,bt470bg:5,smpte170m:6}[i.primaries]},{id:21945,data:[1,2][Number(i.fullRange)]}],!e(this,d).streaming){let s=e(this,u).pos;e(this,u).seek(e(this,u).offsets.get(e(this,V))),e(this,u).writeEBML(e(this,V)),e(this,u).seek(s)}}t.decoderConfig.description&&(e(this,d).streaming?f(this,B,o(this,Y,zt).call(this,t.decoderConfig.description)):o(this,dt,Lt).call(this,e(this,B),t.decoderConfig.description))}},le=new WeakSet,Ie=function(t){if(t.type!=="key"||!e(this,nt))return;let i=0;if(F(t.data,0,2)!==2)return;i+=2;let s=(F(t.data,i+1,i+2)<<1)+F(t.data,i+0,i+1);i+=2,s===3&&i++;let r=F(t.data,i+0,i+1);if(i++,r)return;let a=F(t.data,i+0,i+1);if(i++,a!==0)return;i+=2;let l=F(t.data,i+0,i+24);if(i+=24,l!==4817730)return;s>=2&&i++;let m={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[e(this,nt).matrix];Me(t.data,i+0,i+3,m)},ot=new WeakSet,jt=function(){let t=Math.min(e(this,d).video?e(this,K):1/0,e(this,d).audio?e(this,G):1/0),i=e(this,P);for(;i.length>0&&i[0].timestamp<=t;)o(this,C,S).call(this,i.shift(),!e(this,d).video&&!e(this,d).audio)},ht=new WeakSet,Jt=function(t,i,s,r,a,l){let m=o(this,ue,ti).call(this,s,r);return{data:t,additions:l,type:i,timestamp:m,duration:a,trackNumber:r}},ue=new WeakSet,ti=function(t,i){let s=i===L?e(this,K):i===Ut?e(this,G):e(this,Dt);if(i!==Xt){let r=i===L?e(this,rt):e(this,at);if(e(this,d).firstTimestampBehavior==="strict"&&s===-1&&t!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${t}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
If you want to allow non-zero first timestamps, set firstTimestampBehavior: 'permissive'.
`);e(this,d).firstTimestampBehavior==="offset"&&(t-=r)}if(t<s)throw new Error(`Timestamps must be monotonically increasing (went from ${s} to ${t}).`);if(t<0)throw new Error(`Timestamps must be non-negative (received ${t}).`);return t},C=new WeakSet,S=function(t,i){e(this,d).streaming&&!e(this,N)&&(o(this,Pt,xe).call(this),o(this,vt,Se).call(this));let s=Math.floor(t.timestamp/1e3),r=i&&t.type==="key"&&s-e(this,st)>=1e3;(!e(this,k)||r)&&o(this,fe,ei).call(this,s);let a=s-e(this,st);if(a<0)return;if(a>=ke)throw new Error(`Current Matroska cluster exceeded its maximum allowed length of ${ke} milliseconds. In order to produce a correct WebM file, you must pass in a key frame at least every ${ke} milliseconds.`);let m=new Uint8Array(4),w=new DataView(m.buffer);if(w.setUint8(0,128|t.trackNumber),w.setInt16(1,a,!1),t.duration===void 0&&!t.additions){w.setUint8(3,Number(t.type==="key")<<7);let p={id:163,data:[m,t.data]};e(this,u).writeEBML(p)}else{let p=Math.floor(t.duration/1e3),ft={id:160,data:[{id:161,data:[m,t.data]},t.duration!==void 0?{id:155,data:p}:null,t.additions?{id:30113,data:t.additions}:null]};e(this,u).writeEBML(ft)}f(this,$,Math.max(e(this,$),s))},Y=new WeakSet,zt=function(t){return{id:25506,size:4,data:new Uint8Array(t)}},dt=new WeakSet,Lt=function(t,i){let s=e(this,u).pos;e(this,u).seek(e(this,u).offsets.get(t));let r=2+4+i.byteLength,a=Et-r;if(a<0){let l=i.byteLength+a;i instanceof ArrayBuffer?i=i.slice(0,l):i=i.buffer.slice(0,l),a=0}t=[o(this,Y,zt).call(this,i),{id:236,size:4,data:new Uint8Array(a)}],e(this,u).writeEBML(t),e(this,u).seek(s)},fe=new WeakSet,ei=function(t){e(this,k)&&!e(this,d).streaming&&o(this,Rt,Ae).call(this),f(this,k,{id:524531317,size:e(this,d).streaming?-1:Ke,data:[{id:231,data:t}]}),e(this,u).writeEBML(e(this,k)),f(this,st,t);let i=e(this,u).offsets.get(e(this,k))-e(this,R,tt);e(this,W).data.push({id:187,data:[{id:179,data:t},e(this,d).video?{id:183,data:[{id:247,data:L},{id:241,data:i}]}:null,e(this,d).audio?{id:183,data:[{id:247,data:Ut},{id:241,data:i}]}:null]})},Rt=new WeakSet,Ae=function(){let t=e(this,u).pos-e(this,u).dataOffsets.get(e(this,k)),i=e(this,u).pos;e(this,u).seek(e(this,u).offsets.get(e(this,k))+4),e(this,u).writeEBMLVarInt(t,Ke),e(this,u).seek(i)},lt=new WeakSet,It=function(){if(e(this,Vt))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};var Mt=/(?:(.+?)\n)?((?:\d{2}:)?\d{2}:\d{2}.\d{3})\s+-->\s+((?:\d{2}:)?\d{2}:\d{2}.\d{3})/g,Ci=/^WEBVTT.*?\n{2}/,Ti=/(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})/,ii=/<(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})>/g,Ue=new TextEncoder,Z,Ft,_t,Nt,Ot,ut,ce,be,si,me=class{constructor(t){n(this,ut);n(this,be);n(this,Z,void 0);n(this,Ft,void 0);n(this,_t,!1);n(this,Nt,void 0);n(this,Ot,!1);f(this,Z,t)}configure(t){if(t.codec!=="webvtt")throw new Error("Codec must be 'webvtt'.");f(this,Ft,t)}encode(t){var s;if(!e(this,Ft))throw new Error("Encoder not configured.");t=t.replace(`\r
`,`
`).replace("\r",`
`),Mt.lastIndex=0;let i;if(!e(this,_t)){if(!Ci.test(t)){let a=new Error("WebVTT preamble incorrect.");throw e(this,Z).error(a),a}i=Mt.exec(t);let r=t.slice(0,(s=i==null?void 0:i.index)!=null?s:t.length).trimEnd();if(!r){let a=new Error("No WebVTT preamble provided.");throw e(this,Z).error(a),a}f(this,Nt,Ue.encode(r)),f(this,_t,!0),i&&(t=t.slice(i.index),Mt.lastIndex=0)}for(;i=Mt.exec(t);){let r=t.slice(0,i.index),a=i[1]||"",l=i.index+i[0].length,m=t.indexOf(`
`,l)+1,w=t.slice(l,m).trim(),p=t.indexOf(`

`,l);p===-1&&(p=t.length);let ft=o(this,ut,ce).call(this,i[2]),ri=o(this,ut,ce).call(this,i[3])-ft,pe=t.slice(m,p),Ee=`${w}
${a}
${r}`;ii.lastIndex=0,pe=pe.replace(ii,ni=>{let oi=o(this,ut,ce).call(this,ni.slice(1,-1))-ft;return`<${o(this,be,si).call(this,oi)}>`}),t=t.slice(p).trimStart(),Mt.lastIndex=0;let ai={body:Ue.encode(pe),additions:Ee===`

`?void 0:Ue.encode(Ee),timestamp:ft*1e3,duration:ri*1e3},ze={};e(this,Ot)||(ze.decoderConfig={description:e(this,Nt)},f(this,Ot,!0)),e(this,Z).output(ai,ze)}}};Z=new WeakMap,Ft=new WeakMap,_t=new WeakMap,Nt=new WeakMap,Ot=new WeakMap,ut=new WeakSet,ce=function(t){let i=Ti.exec(t);if(!i)throw new Error("Expected match.");return 60*60*1e3*Number(i[1]||"0")+60*1e3*Number(i[2])+1e3*Number(i[3])+Number(i[4])},be=new WeakSet,si=function(t){let i=Math.floor(t/36e5),s=Math.floor(t%(60*60*1e3)/(60*1e3)),r=Math.floor(t%(60*1e3)/1e3),a=t%1e3;return i.toString().padStart(2,"0")+":"+s.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+"."+a.toString().padStart(3,"0")};return ci(ki);})();
if (typeof module === "object" && typeof module.exports === "object") Object.assign(module.exports, WebMMuxer)
