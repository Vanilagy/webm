"use strict";var WebMMuxer=(()=>{var J=Object.defineProperty;var $t=Object.getOwnPropertyDescriptor;var Mt=Object.getOwnPropertyNames,gt=Object.getOwnPropertySymbols;var Tt=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable;var c=Math.pow,Ct=(r,t,i)=>t in r?J(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i,Ut=(r,t)=>{for(var i in t||={})Tt.call(t,i)&&Ct(r,i,t[i]);if(gt)for(var i of gt(t))Yt.call(t,i)&&Ct(r,i,t[i]);return r};var qt=(r,t)=>{for(var i in t)J(r,i,{get:t[i],enumerable:!0})},Et=(r,t,i,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Mt(t))!Tt.call(r,a)&&a!==i&&J(r,a,{get:()=>t[a],enumerable:!(s=$t(t,a))||s.enumerable});return r};var Qt=r=>Et(J({},"__esModule",{value:!0}),r);var mt=(r,t,i)=>{if(!t.has(r))throw TypeError("Cannot "+i)};var e=(r,t,i)=>(mt(r,t,"read from private field"),i?i.call(r):t.get(r)),h=(r,t,i)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,i)},b=(r,t,i,s)=>(mt(r,t,"write to private field"),s?s.call(r,i):t.set(r,i),i);var l=(r,t,i)=>(mt(r,t,"access private method"),i);var Lt={};qt(Lt,{default:()=>Bt});var z=class{constructor(t){this.value=t}},B=class{constructor(t){this.value=t}};var dt=r=>r<1<<8?1:r<1<<16?2:r<1<<24?3:r<c(2,32)?4:r<c(2,40)?5:6,At=r=>{if(r<(1<<7)-1)return 1;if(r<(1<<14)-1)return 2;if(r<(1<<21)-1)return 3;if(r<(1<<28)-1)return 4;if(r<c(2,35)-1)return 5;if(r<c(2,42)-1)return 6;throw new Error("EBML VINT size not supported "+r)};var w,o,L,St,I,zt,tt,Ft,$,bt,et,Vt,v=class{constructor(){h(this,L);h(this,I);h(this,tt);h(this,$);h(this,et);this.pos=0;h(this,w,new Uint8Array(8));h(this,o,new DataView(e(this,w).buffer));this.offsets=new WeakMap;this.dataOffsets=new WeakMap}writeEBMLVarInt(t,i=At(t)){let s=0;switch(i){case 1:e(this,o).setUint8(s++,1<<7|t);break;case 2:e(this,o).setUint8(s++,1<<6|t>>8),e(this,o).setUint8(s++,t);break;case 3:e(this,o).setUint8(s++,1<<5|t>>16),e(this,o).setUint8(s++,t>>8),e(this,o).setUint8(s++,t);break;case 4:e(this,o).setUint8(s++,1<<4|t>>24),e(this,o).setUint8(s++,t>>16),e(this,o).setUint8(s++,t>>8),e(this,o).setUint8(s++,t);break;case 5:e(this,o).setUint8(s++,1<<3|t/c(2,32)&7),e(this,o).setUint8(s++,t>>24),e(this,o).setUint8(s++,t>>16),e(this,o).setUint8(s++,t>>8),e(this,o).setUint8(s++,t);break;case 6:e(this,o).setUint8(s++,1<<2|t/c(2,40)&3),e(this,o).setUint8(s++,t/c(2,32)|0),e(this,o).setUint8(s++,t>>24),e(this,o).setUint8(s++,t>>16),e(this,o).setUint8(s++,t>>8),e(this,o).setUint8(s++,t);break;default:throw new Error("Bad EBML VINT size "+i)}this.write(e(this,w).subarray(0,s))}writeEBML(t){var i,s;if(t!==null)if(t instanceof Uint8Array)this.write(t);else if(Array.isArray(t))for(let a of t)this.writeEBML(a);else if(this.offsets.set(t,this.pos),l(this,$,bt).call(this,t.id),Array.isArray(t.data)){let a=this.pos,n=t.size===-1?1:(i=t.size)!=null?i:4;t.size===-1?l(this,L,St).call(this,255):this.seek(this.pos+n);let u=this.pos;if(this.dataOffsets.set(t,u),this.writeEBML(t.data),t.size!==-1){let d=this.pos-u,ft=this.pos;this.seek(a),this.writeEBMLVarInt(d,n),this.seek(ft)}}else if(typeof t.data=="number"){let a=(s=t.size)!=null?s:dt(t.data);this.writeEBMLVarInt(a),l(this,$,bt).call(this,t.data,a)}else typeof t.data=="string"?(this.writeEBMLVarInt(t.data.length),l(this,et,Vt).call(this,t.data)):t.data instanceof Uint8Array?(this.writeEBMLVarInt(t.data.byteLength,t.size),this.write(t.data)):t.data instanceof z?(this.writeEBMLVarInt(4),l(this,I,zt).call(this,t.data.value)):t.data instanceof B&&(this.writeEBMLVarInt(8),l(this,tt,Ft).call(this,t.data.value))}};w=new WeakMap,o=new WeakMap,L=new WeakSet,St=function(t){e(this,o).setUint8(0,t),this.write(e(this,w).subarray(0,1))},I=new WeakSet,zt=function(t){e(this,o).setFloat32(0,t,!1),this.write(e(this,w).subarray(0,4))},tt=new WeakSet,Ft=function(t){e(this,o).setFloat64(0,t,!1),this.write(e(this,w))},$=new WeakSet,bt=function(t,i=dt(t)){let s=0;switch(i){case 6:e(this,o).setUint8(s++,t/c(2,40)|0);case 5:e(this,o).setUint8(s++,t/c(2,32)|0);case 4:e(this,o).setUint8(s++,t>>24);case 3:e(this,o).setUint8(s++,t>>16);case 2:e(this,o).setUint8(s++,t>>8);case 1:e(this,o).setUint8(s++,t);break;default:throw new Error("Bad UINT size "+i)}this.write(e(this,w).subarray(0,s))},et=new WeakSet,Vt=function(t){this.write(new Uint8Array(t.split("").map(i=>i.charCodeAt(0))))};var C,V,H=class extends v{constructor(){super();h(this,C,new ArrayBuffer(c(2,16)));h(this,V,new Uint8Array(e(this,C)))}ensureSize(i){let s=e(this,C).byteLength;for(;s<i;)s*=2;if(s===e(this,C).byteLength)return;let a=new ArrayBuffer(s),n=new Uint8Array(a);n.set(e(this,V),0),b(this,C,a),b(this,V,n)}write(i){this.ensureSize(this.pos+i.byteLength),e(this,V).set(i,this.pos),this.pos+=i.byteLength}seek(i){this.pos=i}finalize(){return this.ensureSize(this.pos),e(this,C).slice(0,this.pos)}};C=new WeakMap,V=new WeakMap;var F=c(2,24),Xt=2,M,p,K=class extends v{constructor(i){super();h(this,M,void 0);h(this,p,[]);b(this,M,i)}write(i){this.writeDataIntoChunks(i,this.pos),this.flushChunks(),this.pos+=i.byteLength}writeDataIntoChunks(i,s){let a=e(this,p).findIndex(S=>S.start<=s&&s<S.start+F);a===-1&&(a=this.createChunk(s));let n=e(this,p)[a],u=s-n.start,d=i.subarray(0,Math.min(F-u,i.byteLength));n.data.set(d,u);let ft={start:u,end:u+d.byteLength};if(Zt(n,ft),n.written[0].start===0&&n.written[0].end===F&&(n.shouldFlush=!0),e(this,p).length>Xt){for(let S=0;S<e(this,p).length-1;S++)e(this,p)[S].shouldFlush=!0;this.flushChunks()}d.byteLength<i.byteLength&&this.writeDataIntoChunks(i.subarray(d.byteLength),s+d.byteLength)}createChunk(i){let a={start:Math.floor(i/F)*F,data:new Uint8Array(F),written:[],shouldFlush:!1};return e(this,p).push(a),e(this,p).sort((n,u)=>n.start-u.start),e(this,p).indexOf(a)}flushChunks(i=!1){for(let s=0;s<e(this,p).length;s++){let a=e(this,p)[s];if(!(!a.shouldFlush&&!i)){for(let n of a.written)e(this,M).write({type:"write",data:a.data.subarray(n.start,n.end),position:a.start+n.start});e(this,p).splice(s--,1)}}}seek(i){this.pos=i}finalize(){this.flushChunks(!0)}};M=new WeakMap,p=new WeakMap;var Zt=(r,t)=>{let i=0,s=r.written.length-1,a=-1;for(;i<=s;){let n=Math.floor(i+(s-i+1)/2);r.written[n].start<=t.start?(i=n+1,a=n):s=n-1}for(r.written.splice(a+1,0,t),(a===-1||r.written[a].end<t.start)&&a++;a<r.written.length-1&&r.written[a].end>=r.written[a+1].start;)r.written[a].end=Math.max(r.written[a].end,r.written[a+1].end),r.written.splice(a+1,1)},T,Y,D=class extends v{constructor(i){super();h(this,T,[]);h(this,Y,void 0);b(this,Y,i)}write(i){e(this,T).push({data:i.slice(),start:this.pos}),this.pos+=i.byteLength}seek(i){this.pos=i}flush(i){if(e(this,T).length===0)return;let s=[],a=[...e(this,T)].sort((n,u)=>n.start-u.start);s.push({start:a[0].start,size:a[0].data.byteLength});for(let n=1;n<a.length;n++){let u=s[s.length-1],d=a[n];d.start<=u.start+u.size?u.size=Math.max(u.size,d.start+d.data.byteLength-u.start):s.push({start:d.start,size:d.data.byteLength})}for(let n of s){n.data=new Uint8Array(n.size);for(let d of e(this,T))n.start<=d.start&&d.start<n.start+n.size&&n.data.set(d.data,d.start-n.start);let u=i&&n===s[s.length-1];e(this,Y).call(this,n.data,n.start,u)}e(this,T).length=0}};T=new WeakMap,Y=new WeakMap;var P=1,ct=2,jt=1,Gt=2,pt=c(2,15),Dt="https://github.com/Vanilagy/webm-muxer",Pt=5,Jt=["strict","offset","permissive"],f,m,q,E,y,A,Q,k,x,R,_,N,O,X,st,Rt,rt,_t,at,Nt,nt,Ot,ht,Wt,ot,vt,W,it,Z,yt,lt,Ht,g,U,ut,Kt,j,kt,G,xt,wt=class{constructor(t){h(this,st);h(this,rt);h(this,at);h(this,nt);h(this,ht);h(this,ot);h(this,W);h(this,Z);h(this,lt);h(this,g);h(this,ut);h(this,j);h(this,G);h(this,f,void 0);h(this,m,void 0);h(this,q,void 0);h(this,E,void 0);h(this,y,void 0);h(this,A,void 0);h(this,Q,0);h(this,k,[]);h(this,x,[]);h(this,R,void 0);h(this,_,void 0);h(this,N,-1);h(this,O,-1);h(this,X,!1);if(l(this,st,Rt).call(this,t),b(this,m,Ut({type:"webm",firstTimestampBehavior:"strict"},t)),t.target==="buffer")b(this,f,new H);else if(t.target instanceof FileSystemWritableFileStream)b(this,f,new K(t.target));else if(typeof t.target=="function")b(this,f,new D(t.target));else throw new Error(`Invalid target: ${t.target}`);l(this,rt,_t).call(this)}addVideoChunk(t,i,s){let a=new Uint8Array(t.byteLength);t.copyTo(a),this.addVideoChunkRaw(a,t.type,s!=null?s:t.timestamp,i)}addVideoChunkRaw(t,i,s,a){if(l(this,G,xt).call(this),!e(this,m).video)throw new Error("No video track declared.");e(this,R)===void 0&&b(this,R,s);let n=l(this,Z,yt).call(this,t,i,s,P);for(b(this,N,n.timestamp);e(this,x).length>0&&e(this,x)[0].timestamp<=n.timestamp;){let u=e(this,x).shift();l(this,g,U).call(this,u)}!e(this,m).audio||n.timestamp<=e(this,O)?l(this,g,U).call(this,n):e(this,k).push(n),l(this,W,it).call(this)}addAudioChunk(t,i,s){let a=new Uint8Array(t.byteLength);t.copyTo(a),this.addAudioChunkRaw(a,t.type,s!=null?s:t.timestamp,i)}addAudioChunkRaw(t,i,s,a){if(l(this,G,xt).call(this),!e(this,m).audio)throw new Error("No audio track declared.");e(this,_)===void 0&&b(this,_,s);let n=l(this,Z,yt).call(this,t,i,s,ct);for(b(this,O,n.timestamp);e(this,k).length>0&&e(this,k)[0].timestamp<=n.timestamp;){let u=e(this,k).shift();l(this,g,U).call(this,u)}!e(this,m).video||n.timestamp<=e(this,N)?l(this,g,U).call(this,n):e(this,x).push(n),l(this,W,it).call(this)}finalize(){for(;e(this,k).length>0;)l(this,g,U).call(this,e(this,k).shift());for(;e(this,x).length>0;)l(this,g,U).call(this,e(this,x).shift());l(this,j,kt).call(this);let t=e(this,f).pos;return e(this,f).seek(t),b(this,X,!0),e(this,f)instanceof H?e(this,f).finalize():(e(this,f)instanceof K?e(this,f).finalize():e(this,f)instanceof D&&e(this,f).flush(!0),null)}};f=new WeakMap,m=new WeakMap,q=new WeakMap,E=new WeakMap,y=new WeakMap,A=new WeakMap,Q=new WeakMap,k=new WeakMap,x=new WeakMap,R=new WeakMap,_=new WeakMap,N=new WeakMap,O=new WeakMap,X=new WeakMap,st=new WeakSet,Rt=function(t){if(t.type&&t.type!=="webm"&&t.type!=="matroska")throw new Error(`Invalid type: ${t.type}`);if(t.firstTimestampBehavior&&!Jt.includes(t.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${t.firstTimestampBehavior}`)},rt=new WeakSet,_t=function(){l(this,at,Nt).call(this),l(this,nt,Ot).call(this),l(this,ht,Wt).call(this),l(this,ot,vt).call(this),l(this,W,it).call(this)},at=new WeakSet,Nt=function(){var i;let t={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:(i=e(this,m).type)!=null?i:"webm"},{id:17031,data:2},{id:17029,data:2}]};e(this,f).writeEBML(t)},nt=new WeakSet,Ot=function(){let t={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:Dt},{id:22337,data:Dt}]};b(this,q,t)},ht=new WeakSet,Wt=function(){let t={id:374648427,data:[]};b(this,E,t),e(this,m).video&&t.data.push({id:174,data:[{id:215,data:P},{id:29637,data:P},{id:131,data:jt},{id:134,data:e(this,m).video.codec},{id:224,data:[{id:176,data:e(this,m).video.width},{id:186,data:e(this,m).video.height},e(this,m).video.alpha?{id:21440,data:1}:null]}]}),e(this,m).audio&&t.data.push({id:174,data:[{id:215,data:ct},{id:29637,data:ct},{id:131,data:Gt},{id:134,data:e(this,m).audio.codec},{id:225,data:[{id:181,data:new z(e(this,m).audio.sampleRate)},{id:159,data:e(this,m).audio.numberOfChannels},e(this,m).audio.bitDepth?{id:25188,data:e(this,m).audio.bitDepth}:null]}]})},ot=new WeakSet,vt=function(){let t={id:408125543,size:-1,data:[e(this,q),e(this,E)]};e(this,f).writeEBML(t)},W=new WeakSet,it=function(){e(this,f)instanceof D&&e(this,f).flush(!1)},Z=new WeakSet,yt=function(t,i,s,a){let n=l(this,lt,Ht).call(this,s,a);return{data:t,type:i,timestamp:n,trackNumber:a}},lt=new WeakSet,Ht=function(t,i){let s=i===P?e(this,R):e(this,_),a=i===P?e(this,N):e(this,O);if(e(this,m).firstTimestampBehavior==="strict"&&a===-1&&t!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${t}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
If you want to allow non-zero first timestamps, set firstTimestampBehavior: 'permissive'.
`);if(e(this,m).firstTimestampBehavior==="offset"&&(t-=s),t<a)throw new Error(`Timestamps must be monotonically increasing (went from ${a} to ${t}).`);return t},g=new WeakSet,U=function(t){let i=Math.floor(t.timestamp/1e3);if(t.type!=="key"&&i-e(this,A)>=pt)throw new Error(`Current Matroska cluster exceeded its maximum allowed length of ${pt} milliseconds. In order to produce a correct WebM file, you must pass in a video key frame at least every ${pt} milliseconds.`);let a=(t.trackNumber===P||!e(this,m).video)&&t.type==="key"&&i-e(this,A)>=1e3;(!e(this,y)||a)&&l(this,ut,Kt).call(this,i);let n=new Uint8Array(4),u=new DataView(n.buffer);u.setUint8(0,128|t.trackNumber),u.setUint16(1,i-e(this,A),!1),u.setUint8(3,Number(t.type==="key")<<7);let d={id:163,data:[n,t.data]};e(this,f).writeEBML(d),b(this,Q,Math.max(e(this,Q),i))},ut=new WeakSet,Kt=function(t){e(this,y)&&l(this,j,kt).call(this),b(this,y,{id:524531317,size:Pt,data:[{id:231,data:t}]}),e(this,f).writeEBML(e(this,y)),b(this,A,t)},j=new WeakSet,kt=function(){let t=e(this,f).pos-e(this,f).dataOffsets.get(e(this,y)),i=e(this,f).pos;e(this,f).seek(e(this,f).offsets.get(e(this,y))+4),e(this,f).writeEBMLVarInt(t,Pt),e(this,f).seek(i)},G=new WeakSet,xt=function(){if(e(this,X))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};var Bt=wt;return Qt(Lt);})();
WebMMuxer = WebMMuxer.default;
if (typeof module === "object" && typeof module.exports === "object") module.exports = WebMMuxer;
